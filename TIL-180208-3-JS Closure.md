# Javascript **Closure** 클로저



## 1. 클로저(closure)의 개념

**클로저는 내부함수가 참조하는 외부함수의 지역변수가 외부함수에 의해 내부함수가 반환된 이후에도 life-cycle이 유지되는 것을 의미한다.**

함수를 일급 객체로 취급하는 함수형 언어(Functional language: Python, Haskell, Erlang, Perl, D, R…)에서 사용되는 중요한 특성



<내부함수의 외부함수 변수 접근 예제>

```javascript
function outerFunc() {
  var x = 10;
  var innerFunc = function () { console.log(x); };
  innerFunc();
}

outerFunc(); // 10
```

중첩된 함수의 스코프 레퍼런스를 차례대로 저장하고 있는 실행 컨텍스트의 스코프 체인을 자바스크립트 엔진이 검색, 내부 함수에 없는 값을 상위 함수까지 찾아 참조 반환



<외부함수 호출시 내부 함수 반환 예제>

```javascript
function outerFunc() {
  var x = 10; //클로저에 의해 참조되는 '자유변수 x'
  var innerFunc = function () { console.log(x); };
  return innerFunc;
}

// 함수 outerFunc를 호출하면 내부 함수 innerFunc가 반환된다. 그리고 함수 outerFunc의 실행 컨텍스트는 소멸한다
var inner = outerFunc();
inner(); // 10
```

위 예제는 자신을 포함하고 있는 외부함수보다 내부함수가 더 오래 유지되는 경우인데 이때 내부함수가 외부함수의 지역 변수에 접근할 수 있고, 외부함수는 외부함수의 지역변수를 사용하는 내부함수가 소멸될 때까지 소멸되지 못하고 상태가 유지되며 내부함수에 의해서 소멸하게 되는 특성을 클로저(Closure)라고 부른다.

클로저에 의해 참조되는 외부함수의 변수 즉 outerFunc 함수의 변수 x를 **자유변수(Free variable)**라고 부른다.클로저라는 이름은 자유변수에 함수가 닫혀있다(closed)라는 의미로 의역하면 자유변수에 엮여있는 함수라는 뜻이다.



<`실행 컨텍스트`의 관점에 설명>

내부함수가 유효한 상태에서 외부함수가 종료하여 외부함수의 실행 컨텍스트가 반환되어도/ 
외부함수 실행 컨텍스트 내의 **Activation object**(변수, 함수 선언 등의 정보를 가지고 있다)는 유효하여/
내부함수가 **스코프 체인**을 통해 참조할 수 있는 것을 의미.

외부함수가 이미 반환되었어도 외부함수 내의 변수는 이를 필요로 하는 내부함수가 하나 이상 존재하는 경우 계속 유지된다.
이때 내부함수가 외부함수에 있는 변수의 복사본이 아니라 실제 변수에 접근한다는 것에 주의



![closure](http://poiemaweb.com/img/closure.png)





## 2. 클로저의 활용

클로저는 강력한 기능이나 성능적 자원적 손해 볼수있다. 무분별 사용 지양하자.

### 2.1 전역 변수의 사용 억제

전역 변수 사용시, 중복된 이름, 값 변경 문제 야기.
위 문제로 함수 내에 지역 변수 사용 하면 호출시 값이 늘 초기화.
클로저 사용하여 해결



## 2.2 setTimeout의 콜백 함수



## 2.3 자주 발생하는 실수